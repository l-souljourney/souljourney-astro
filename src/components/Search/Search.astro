---
import Search from "astro-pagefind/components/Search";
---

<section class="vh-search fixed left-0 top-0 w-screen h-screen pt-[3.75rem] px-4 pb-4 flex items-center flex-col bg-black/26 opacity-0 pointer-events-none z-50 transition-opacity duration-180">
	<main class="p-4 py-3 w-full max-w-[888px] max-h-[88vh] rounded-2xl bg-white dark:bg-[#252525] -translate-y-4 transition-transform duration-180 overflow-hidden">
        <div class="pagefind-wrapper">
		    <Search id="search" className="pagefind-ui" uiOptions={{ showImages: false }} />
        </div>
	</main>
</section>

<script>
    // Simple toggle logic for the search modal
    const initSearchModal = () => {
        const searchBtn = document.querySelector(".search-btn");
        const searchModal = document.querySelector(".vh-search");
        const searchMain = document.querySelector(".vh-search > main");

        if (!searchBtn || !searchModal || !searchMain) return;

        const openModal = () => {
            searchModal.classList.add("active");
            // Focus the input if possible, though pagefind might render it async
            setTimeout(() => {
                const input = searchModal.querySelector("input");
                if (input) input.focus();
            }, 100);
        };

        const closeModal = () => {
            searchModal.classList.remove("active");
        };

        searchBtn.addEventListener("click", (e) => {
            e.stopPropagation();
            openModal();
        });

        searchModal.addEventListener("click", (e) => {
            closeModal();
        });

        searchMain.addEventListener("click", (e) => {
            e.stopPropagation();
        });
        
        // Close on escape key
        document.addEventListener("keydown", (e) => {
            if (e.key === "Escape" && searchModal.classList.contains("active")) {
                closeModal();
            }
        });
    };

    // Run on initial load
    initSearchModal();

    // Run on view transitions navigation
    document.addEventListener("astro:page-load", initSearchModal);
</script>

<style>
    /* Active state for search modal */
    .vh-search.active {
        opacity: 1;
        pointer-events: auto;
    }
    .vh-search.active > main {
        transform: translateY(0);
    }
</style>

<style is:global>
    /* Override Pagefind styles to match the modal */
    .vh-search .pagefind-wrapper {
        width: 100%;
    }
    
    .vh-search .pagefind-ui {
        width: 100%;
    }

    .vh-search .pagefind-ui .pagefind-ui__search-input {
        background-color: var(--vh-font-6);
        border: none;
        border-radius: 0.66rem;
        padding: 1rem 1rem 1rem 2.5rem; /* Add left padding for the icon */
        font-size: 1rem;
        color: var(--vh-font-color);
        box-sizing: border-box;
        font-weight: normal;
    }
    
    /* Position the search icon */
    .vh-search .pagefind-ui .pagefind-ui__search-clear {
        background-color: transparent;
        top: 50%;
        transform: translateY(-50%);
        color: var(--vh-font-color);
    }
    
    /* Ensure the form relative positioning for icon */
    .vh-search .pagefind-ui form {
        position: relative;
    }
    
    /* Custom icon styling if needed, or rely on Pagefind's default */
    .vh-search .pagefind-ui .pagefind-ui__search-icon {
        position: absolute;
        left: 1rem;
        top: 50%;
        transform: translateY(-50%);
        pointer-events: none;
        opacity: 0.6;
        color: var(--vh-font-color);
    }

    .vh-search .pagefind-ui .pagefind-ui__drawer {
        background-color: var(--vh-white-color);
        max-height: 70vh;
        overflow-y: auto;
    }

    .vh-search .pagefind-ui .pagefind-ui__result {
        border-bottom: 1px solid var(--vh-font-6);
        padding: 1rem 0;
    }

    .vh-search .pagefind-ui .pagefind-ui__result-title {
        font-size: 1.1rem;
        font-weight: 600;
    }
    
    .vh-search .pagefind-ui .pagefind-ui__result-link {
        color: var(--vh-font-color);
    }

    .vh-search .pagefind-ui .pagefind-ui__result-excerpt {
        color: var(--vh-font-66);
    }
    
    
    /* ========== Dark Mode Overrides ========== */
    html.dark .vh-search {
        /* Color variables for dark mode */
        --search-dark-bg-input: #333333;
        --search-dark-bg-hover: #444444;
        --search-dark-border: #444444;
        --search-dark-text-primary: #eeeeee;
        --search-dark-text-secondary: #aaaaaa;
        --search-dark-text-tertiary: #888888;
    }
    
    /* Input field */
    html.dark .vh-search .pagefind-ui__search-input {
        background-color: var(--search-dark-bg-input) !important;
        color: var(--search-dark-text-primary) !important;
    }
    
    html.dark .vh-search .pagefind-ui__search-input::placeholder {
        color: var(--search-dark-text-secondary) !important;
        opacity: 0.6;
    }
    
    /* Results container */
    html.dark .vh-search .pagefind-ui__drawer {
        background-color: transparent !important;
    }
    
    /* Individual result items */
    html.dark .vh-search .pagefind-ui__result {
        border-bottom-color: var(--search-dark-border) !important;
    }
    
    html.dark .vh-search .pagefind-ui__result-title a {
        color: var(--search-dark-text-primary) !important;
        font-weight: 500;
    }
    
    html.dark .vh-search .pagefind-ui__result-excerpt {
        color: var(--search-dark-text-secondary) !important;
    }
    
    html.dark .vh-search .pagefind-ui__result-link {
        color: var(--search-dark-text-tertiary) !important;
    }
    
    html.dark .vh-search .pagefind-ui__message {
        color: var(--search-dark-text-secondary) !important;
    }
    
    /* Buttons */
    html.dark .vh-search .pagefind-ui__button {
        background-color: var(--search-dark-bg-input) !important;
        color: var(--search-dark-text-primary) !important;
        border: 1px solid var(--search-dark-border) !important;
        transition: background-color 0.18s ease-in-out;
    }
    
    html.dark .vh-search .pagefind-ui__button:hover {
        background-color: var(--search-dark-bg-hover) !important;
    }
    
    /* Icons */
    html.dark .vh-search .pagefind-ui__search-icon,
    html.dark .vh-search .pagefind-ui__search-icon svg {
        color: var(--search-dark-text-secondary) !important;
        fill: var(--search-dark-text-secondary) !important;
    }
    
    html.dark .vh-search .pagefind-ui__search-clear {
        color: var(--search-dark-text-secondary) !important;
        background-color: transparent !important;
    }
</style>
