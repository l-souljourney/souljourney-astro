---
import { getCollection } from "astro:content";
import { getLangFromUrl, useTranslations } from '@/i18n/utils';
import { getCategoryDisplayName } from "@/utils/categoryMapping";
// 公共 Layout
import Layout from "@/layouts/Layout/Layout.astro";
// 文章列表组件
import Archive from "@/components/Archive/Archive.astro";
// 转换为 Archive 组件需要的格式
import { getCategoriesList } from "@/utils/getArchive";

export async function getStaticPaths() {
  const posts = await getCollection("blog");
  // Filter for English posts
  const enPosts = posts.filter((post: any) => post.id.startsWith('en/'));
  
  // Get unique categories from English posts
  const categories = [...new Set(enPosts.map((post: any) => post.data.categories))];
  
  return categories.map((category) => ({
    params: { categories: category },
  }));
}

const { categories } = Astro.params;
// const lang = getLangFromUrl(Astro.url);
const categoryDisplayName = getCategoryDisplayName(categories, 'en');
const articleList = await getCategoriesList(categories, 'en');
  
// 页面 Info
const info = {
  title: `Category: ${categoryDisplayName} | L-忠程丨生死看淡不服就淦`,
  description: "L-忠程的博客,分享技术、投资、生活与感悟",
};
---

<Layout title={info.title} description={info.description} activeNav={categories}>
	<Archive articleList={articleList} />
</Layout>
