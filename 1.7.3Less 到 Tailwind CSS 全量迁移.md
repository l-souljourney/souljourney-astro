# 1.7.3 less 重构 tailwind

## Astro 博客现代化重构主计划：Less 到 Tailwind CSS 全量迁移

### 1. 核心战略与架构愿景 (Strategic Vision)

本计划旨在通过"混合渐进式"策略，将 `astro-souljourney` 博客从传统的 Less (BEM) 架构平滑迁移至现代化的 Tailwind CSS (Utility-first) 架构，同时优化动画性能与开发体验。

#### 1.1 架构演进目标
* **样式系统**: Less + CSS Variables → **Tailwind CSS + CSS Variables** (保留语义化变量，享受原子类便利)。
* **页面过渡**: Swup.js → **Astro View Transitions** (原生、高性能、状态保持)。
* **动效系统**: 零散 CSS Transition → **统一 Motion System** (基于 Tailwind 配置)。
* **资源管理**: 手动懒加载 → **Astro `<Image />` + 原生懒加载**。

#### 1.2 关键决策 (Key Decisions)
1. **零回归原则**: 迁移过程中必须保证 UI 100% 一致，无视觉回退。
2. **原子化迁移**: 以组件为最小单位进行迁移，避免"大爆炸式"重构。
3. **性能优先**: 废弃所有 Layout 属性动画 (padding/margin/width)，全面转向 Transform 动画。
4. **Vibe Coding**: 采用 AI 辅助的微步迭代模式，每一步都可验证、可回滚。

---

## 2. 详细执行步骤 (Vibe Coding Execution Plan)

本计划将迁移工作拆解为 **5 个阶段**，每个阶段包含若干 **原子任务单元**。

### 阶段一：基础设施铺设 (Infrastructure)
**目标**: 引入 Tailwind 环境，打通变量系统，不影响现有样式。

* **Step 1.1: 安装与初始化**
    * **操作**: 安装 `tailwindcss`、`postcss`、`autoprefixer`，创建 `tailwind.config.cjs`，在 `src/styles` 添加 `globals.css` 并导入 Tailwind 基础层。
    * **Git**: `chore: add tailwind config and base styles`

* **Step 1.2: 变量映射**
    * **操作**: 将现有 Less 中的 CSS 变量迁移到 `:root` 中的自定义属性，保持语义一致性。
    * **示例**: `--vh-main-color: #1a202c;` → `--color-primary: #1a202c;`

* **Step 1.3: 兼容性检查**
    * **操作**: 确保所有旧的 `.less` 文件仍然被引入，以防止样式缺失，随后逐步删除。

### 阶段二：组件级迁移 (Component Migration)
**目标**: 逐个组件将 Less 样式替换为 Tailwind 原子类。

* **Step 2.1: ArticleCard**
    * **操作**: 将 `src/components/ArticleCard/ArticleCard.astro` 中的类名替换为对应的 Tailwind 实用类，保持视觉一致性。
    * **验证**: 对比截图，确保布局、间距、颜色相同。

* **Step 2.2: Header**
    * **操作**: 同上，迁移导航栏样式，使用 Tailwind 的响应式工具类实现移动端折叠。

* **Step 2.3: Footer & Sidebar**
    * **操作**: 完成剩余公共组件的迁移。

### 阶段三：动效与交互升级 (Animation & Interaction)
**目标**: 用 Tailwind 的 `transition`、`animate` 类统一动效，实现更流畅的交互。

* **Step 3.1: 替换 `@keyframes`**
    * **操作**: 将自定义动画改写为 Tailwind `@keyframes` 配置，并在 `tailwind.config.cjs` 中注册。

* **Step 3.2: 使用 `transform` 动画**
    * **操作**: 将所有基于 `margin/padding` 的动画改为 `translate`/`scale`。

### 阶段四：全局主题与暗黑模式 (Theme & Dark Mode)
**目标**: 实现统一的暗黑模式切换，使用 Tailwind 的 `dark:` 前缀。

* **Step 4.1: 配置 `darkMode: 'class'`**
    * **操作**: 在根元素上切换 `class="dark"`，确保所有组件响应。

* **Step 4.2: 颜色变量映射**
    * **操作**: 将原有的浅色变量映射到 `bg-white`/`text-gray-900`，暗色映射到 `bg-gray-900`/`text-gray-100`。

### 阶段五：回归测试与发布 (Testing & Release)
**目标**: 确保迁移后功能完整，性能不下降。

* **Step 5.1: 单元/集成测试**
    * **操作**: 运行 `npm run test`，确保所有页面渲染正确。

* **Step 5.2: 性能检查**
    * **操作**: 运行 Lighthouse，检查 CLS (累积布局偏移) 和 LCP。确保分数不低于迁移前。

---

## 3. 开发注意事项 (Developer Notes)

### 3.1 测试要点 (Testing Checklist)
* **暗黑模式**: 每次改动颜色相关属性，必须手动切换 `html.dark` 验证。
* **移动端适配**: 使用浏览器开发者工具模拟手机，检查 `flex-col`, `hidden`, `block` 等响应式类是否生效。
* **Hover 状态**: 重点检查 `hover:` 伪类在移动端是否会产生意外的"粘滞"效果。
* **构建检查**: 开发过程中保持 `npm run dev` 运行，每完成一个组件执行一次 `npm run build` 确保生产构建正常。

### 3.2 常见坑与解决方案
* **特异性 (Specificity) 冲突**: Tailwind 原子类优先级较低。如果遇到样式不生效，检查是否被残留的 Less ID 选择器覆盖。解决方案：使用 `!important` (如 `!bg-red-500`) 临时调试，最终通过移除 Less 解决。
* **动态类名**: Astro 中使用模板字符串拼接类名时，确保完整的类名能被 Tailwind 扫描到。
    * **错误**: ``bg-${color}-500``
    * **正确**: `color === 'red' ? 'bg-red-500' : 'bg-blue-500'` 或使用 `safelist`。
* **复杂伪元素**: 对于 `::before`/`::after`，如果 Tailwind 写法过于冗长，建议提取为组件内的 `<style>` 或自定义 CSS 类，不要强行原子化。

### 3.3 Git 提交规范
* 保持提交粒度细小。
* 格式: `type(scope): subject`
    * `refactor(Header): ...`
    * `chore(deps): ...`
    * `style(Aside): ...`

---

## 4. 总结

此计划将风险分散到了每个组件的独立迁移中。通过前期扎实的基础设施铺设（变量映射），后期迁移将变得机械且高效。AI 辅助 (Vibe Coding) 将在组件转换阶段发挥巨大作用，确保代码质量和开发速度。
