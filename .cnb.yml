# 腾讯云 CNB (Cloud Native Builder) 构建配置文件
# L-Souljourney 博客简化部署配置

# 主分支 - 生产部署
main:
  push:
    - name: astro-blog-deploy
      image: node:18
      env:
        NODE_ENV: production
        ASTRO_TELEMETRY_DISABLED: "1"
        TZ: Asia/Shanghai
      
      script: |
        echo "🚀 开始构建 L-Souljourney 博客..."
        
        # 环境信息
        echo "📋 环境信息:"
        node --version
        npm --version
        
        # 安装 pnpm
        echo "📦 安装 pnpm 包管理器..."
        npm install -g pnpm@latest
        pnpm --version
        
        # 安装依赖
        echo "📚 安装项目依赖..."
        pnpm install --frozen-lockfile
        
        # 构建项目
        echo "🔨 构建 Astro 项目..."
        pnpm build
        
        # 显示构建结果
        echo "📊 构建产物信息:"
        ls -la dist/
        du -sh dist/
        find dist -type f | wc -l | xargs echo "文件数量:"
        
        echo "✅ 博客构建完成！"
        echo "💡 请在CNB控制台配置COS部署插件完成自动上传"

# 开发分支 - 仅构建测试
develop:
  push:
    - name: astro-blog-test
      image: node:18
      env:
        NODE_ENV: development
        ASTRO_TELEMETRY_DISABLED: "1"
      
      script: |
        echo "🧪 开发分支构建测试..."
        
        # 安装依赖并构建
        npm install -g pnpm@latest
        pnpm install --frozen-lockfile
        pnpm build
        
        echo "✅ 开发构建测试完成！"

# Pull Request - 代码检查
"**":
  pull_request:
    - name: pr-check
      image: node:18
      script: |
        echo "🔍 PR 构建检查..."
        npm install -g pnpm@latest
        pnpm install --frozen-lockfile
        pnpm build
        echo "✅ PR 构建检查通过" 