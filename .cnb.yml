# è…¾è®¯äº‘ CNB (Cloud Native Builder) æ„å»ºé…ç½®æ–‡ä»¶
# L-Souljourney åšå®¢ç®€åŒ–éƒ¨ç½²é…ç½®

# ä¸»åˆ†æ”¯ - ç”Ÿäº§éƒ¨ç½²
main:
  push:
    - name: astro-blog-deploy
      image: node:18
      env:
        NODE_ENV: production
        ASTRO_TELEMETRY_DISABLED: "1"
        TZ: Asia/Shanghai
      
      script: |
        echo "ğŸš€ å¼€å§‹æ„å»º L-Souljourney åšå®¢..."
        
        # ç¯å¢ƒä¿¡æ¯
        echo "ğŸ“‹ ç¯å¢ƒä¿¡æ¯:"
        node --version
        npm --version
        
        # å®‰è£… pnpm
        echo "ğŸ“¦ å®‰è£… pnpm åŒ…ç®¡ç†å™¨..."
        npm install -g pnpm@latest
        pnpm --version
        
        # å®‰è£…ä¾èµ–
        echo "ğŸ“š å®‰è£…é¡¹ç›®ä¾èµ–..."
        pnpm install --frozen-lockfile
        
        # æ„å»ºé¡¹ç›®
        echo "ğŸ”¨ æ„å»º Astro é¡¹ç›®..."
        pnpm build
        
        # æ˜¾ç¤ºæ„å»ºç»“æœ
        echo "ğŸ“Š æ„å»ºäº§ç‰©ä¿¡æ¯:"
        ls -la dist/
        du -sh dist/
        find dist -type f | wc -l | xargs echo "æ–‡ä»¶æ•°é‡:"
        
        echo "âœ… åšå®¢æ„å»ºå®Œæˆï¼"
        echo "ğŸ’¡ è¯·åœ¨CNBæ§åˆ¶å°é…ç½®COSéƒ¨ç½²æ’ä»¶å®Œæˆè‡ªåŠ¨ä¸Šä¼ "

# å¼€å‘åˆ†æ”¯ - ä»…æ„å»ºæµ‹è¯•
develop:
  push:
    - name: astro-blog-test
      image: node:18
      env:
        NODE_ENV: development
        ASTRO_TELEMETRY_DISABLED: "1"
      
      script: |
        echo "ğŸ§ª å¼€å‘åˆ†æ”¯æ„å»ºæµ‹è¯•..."
        
        # å®‰è£…ä¾èµ–å¹¶æ„å»º
        npm install -g pnpm@latest
        pnpm install --frozen-lockfile
        pnpm build
        
        echo "âœ… å¼€å‘æ„å»ºæµ‹è¯•å®Œæˆï¼"

# Pull Request - ä»£ç æ£€æŸ¥
"**":
  pull_request:
    - name: pr-check
      image: node:18
      script: |
        echo "ğŸ” PR æ„å»ºæ£€æŸ¥..."
        npm install -g pnpm@latest
        pnpm install --frozen-lockfile
        pnpm build
        echo "âœ… PR æ„å»ºæ£€æŸ¥é€šè¿‡" 