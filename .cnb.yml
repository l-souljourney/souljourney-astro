# è…¾è®¯äº‘ CNB (Cloud Native Builder) æ„å»ºé…ç½®æ–‡ä»¶
# L-Souljourney åšå®¢ - ä»£ç åŒæ­¥åˆ°GitHubæ–¹æ¡ˆ

# ä¸»åˆ†æ”¯ - åŒæ­¥åˆ°GitHubè§¦å‘GitHub Actions
# åªæœ‰mainåˆ†æ”¯æ¨é€æ‰ä¼šè§¦å‘æ„å»ºå’ŒåŒæ­¥
main:
  push:
    - # ä»å¯†é’¥ä»“åº“å¯¼å…¥GitHub Token
      imports: https://cnb.cool/l-souljourney/env/-/blob/main/env.yml
      env:
        TZ: Asia/Shanghai
      
      stages:
        - name: sync-to-github
          script: |
            echo "ğŸ”„ å¼€å§‹åŒæ­¥ä»£ç åˆ°GitHub..."
            
            # æ£€æŸ¥GitHub Token
            if [ -z "$GITHUB_TOKEN" ]; then
              echo "âš ï¸  æœªé…ç½®GITHUB_TOKENï¼Œè·³è¿‡åŒæ­¥"
              echo "ğŸ’¡ è¯·åœ¨CNBå¯†é’¥ä»“åº“ä¸­é…ç½®GITHUB_TOKENç¯å¢ƒå˜é‡"
              exit 0
            fi
            
            # é…ç½®Gitç”¨æˆ·ä¿¡æ¯
            git config --global user.email "cnb-sync@l-souljourney.cn"
            git config --global user.name "CNB Auto Sync"
            
            # æ·»åŠ GitHubè¿œç¨‹ä»“åº“
            echo "ğŸ“¡ é…ç½®GitHubè¿œç¨‹ä»“åº“..."
            git remote add github https://${GITHUB_TOKEN}@github.com/l-souljourney/souljourney-astro.git 2>/dev/null || true
            git remote set-url github https://${GITHUB_TOKEN}@github.com/l-souljourney/souljourney-astro.git
            
            # æ¨é€åˆ°GitHub
            echo "ğŸ“¤ æ¨é€åˆ°GitHubä»“åº“..."
            git push github main --force
            
            echo "âœ… ä»£ç åŒæ­¥å®Œæˆï¼"
            echo "ğŸš€ GitHub Actionså°†è‡ªåŠ¨è§¦å‘æ„å»ºéƒ¨ç½²"
            echo "ğŸ“Š åŒæ­¥ä¿¡æ¯:"
            echo "   - Git æäº¤: $CNB_GIT_COMMIT_SHA"
            echo "   - åˆ†æ”¯: $CNB_GIT_REF"
            echo "   - åŒæ­¥æ—¶é—´: $(date)"

# Pull Request - åŒæ­¥åˆ°GitHubè§¦å‘PRæ£€æŸ¥
"**":
  pull_request:
    - stages:
        - name: sync-pr-to-github
          script: |
            echo "ğŸ” PRäº‹ä»¶ - åŒæ­¥åˆ°GitHub..."
            echo "ğŸ’¡ GitHub Actionså°†å¤„ç†PRæ„å»ºæ£€æŸ¥" 