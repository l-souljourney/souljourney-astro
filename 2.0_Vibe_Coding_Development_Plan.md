# L-Souljourney 2.0 Vibe Coding è½åœ°å¼€å‘è§„åˆ’æ–¹æ¡ˆ

åŸºäº **J.D.P-C (Jina-Doubao-PocketBase-CNB)** æ¶æ„çš„æœ€ç»ˆæ‰§è¡Œè“å›¾ã€‚æœ¬æ–¹æ¡ˆå°†ä½œä¸ºåç»­ Coding çš„ç›´æ¥æŒ‡å¯¼æ‰‹å†Œã€‚

## 1. æ ¸å¿ƒæ¶æ„å®šä¹‰ (Core Architecture)

æˆ‘ä»¬å°†æ„å»ºä¸€ä¸ª **ä»¥ PocketBase ä¸ºæ ¸å¿ƒæ¡†æ¶çš„ Go å•ä½“åº”ç”¨**ï¼Œåˆ©ç”¨ **CNB** ä½œä¸ºæ— é™æ‰©å±•çš„å¤–æŒ‚â€œæµ·é©¬ä½“â€ï¼ˆå­˜å‚¨ä¸å‘é‡æ£€ç´¢ï¼‰ï¼Œåˆ©ç”¨ **Doubao** ä½œä¸ºé€»è¾‘æ¨ç†çš„â€œå¤§è„‘â€ã€‚

*   **Language**: Go 1.23+
*   **Framework**: PocketBase (Embedded Mode)
*   **Database**: SQLite (WAL Mode, embedded in PB)
*   **Vector Memory**: CNB Git Repositories (Managed by `.cnb.yml` pipelines)
*   **AI Inference**: Volcengine SDK (Doubao-pro-32k)
*   **Frontend**: Astro 5.0 (SSR + Client-side Islands)

---

## 2. æ•°æ®åº“è®¾è®¡ (PocketBase Schema)

æˆ‘ä»¬å°†é€šè¿‡ Go Migration ä»£ç  (`migrations/`) æ¥å®šä¹‰ Schemaï¼Œç¡®ä¿å¯ç§»æ¤æ€§ã€‚

### 2.1 `personas` (æ•°å­—åˆ†èº«è¡¨)
å®šä¹‰ç³»ç»Ÿä¸­çš„â€œæ··åˆä¸“å®¶â€ã€‚

| Field | Type | Description | Example |
| :--- | :--- | :--- | :--- |
| `slug` | text | å”¯ä¸€æ ‡è¯† | `l_zhongcheng` |
| `name` | text | æ˜¾ç¤ºåç§° | `L-å¿ ç¨‹ (å®æˆ˜æ´¾)` |
| `avatar` | file | å¤´åƒ | `lzc.png` |
| `repo_path` | text | å…³è”çš„ CNB ä»“åº“è·¯å¾„ | `l-souljourney/memory-trading` |
| `system_prompt` | text | **æ ¸å¿ƒäººè®¾** (åŒ…å«ä»·å€¼è§‚ã€è¯­æ°”) | `"ä½ æ˜¯ä¸€ä¸ªä¿¡å¥‰æ ¼é›·å„å§†çš„äº¤æ˜“å‘˜..."` |
| `retrieval_config` | json | æ£€ç´¢å‚æ•°é…ç½® | `{"top_k": 5, "min_score": 0.6}` |
| `is_active` | bool | æ˜¯å¦å¯ç”¨ | `true` |

### 2.2 `articles` (å†…å®¹èµ„äº§è¡¨)
å­˜å‚¨åŸå§‹å†…å®¹åŠ AI çš„åˆ†æç»“æœã€‚

| Field | Type | Description | Example |
| :--- | :--- | :--- | :--- |
| `title` | text | æ ‡é¢˜ | `2025Q1 å¸‚åœºå¤ç›˜` |
| `slug` | text | URL å‹å¥½æ ‡è¯† | `2025-q1-review` |
| `original_url` | url | æ¥æºé“¾æ¥ (å¦‚æœæ˜¯æŠ“å–çš„) | `https://x.com/...` |
| `content` | editor | åŸå§‹å†…å®¹ (Markdown) | `...` |
| `summary` | text | è‡ªåŠ¨æ‘˜è¦ | `...` |
| `tags` | json | æ ‡ç­¾ | `["å¤ç›˜", "å®è§‚"]` |
| `ai_comments` | json | **å„åˆ†èº«è¯„è®º (æ ¸å¿ƒ)** | `{"l_zhongcheng": "...", "lweein": "..."}` |
| `sync_status` | select | CNB åŒæ­¥çŠ¶æ€ | `synced`, `pending`, `failed` |

### 2.3 `tasks` (å¼‚æ­¥ä»»åŠ¡è¡¨ - Optional)
ç”¨äºè¿½è¸ªè€—æ—¶çš„ RAG ç”Ÿæˆä»»åŠ¡ï¼ˆå¦‚æœæœªæ¥é‡å¤§ï¼‰ã€‚

---

## 3. åç«¯å·¥ç¨‹æ¶æ„ (Backend Engineering)

é¡¹ç›®æ ¹ç›®å½•ï¼š`l-engine/`

```plaintext
l-engine/
â”œâ”€â”€ cmd/
â”‚   â””â”€â”€ server/
â”‚       â””â”€â”€ main.go          # Entrypoint: åˆå§‹åŒ– PB, æ³¨å†Œ Hooks
â”œâ”€â”€ migrations/              # DB Schema å®šä¹‰
â”‚   â””â”€â”€ 1700000000_init.go
â”œâ”€â”€ pkg/                     # çº¯ Go ä¸šåŠ¡é€»è¾‘ (Core Domain)
â”‚   â”œâ”€â”€ ai/
â”‚   â”‚   â””â”€â”€ doubao.go        # Client: ChatCompletion
â”‚   â”œâ”€â”€ rag/
â”‚   â”‚   â”œâ”€â”€ cnb.go           # Client: CNB Open API (Push/Query)
â”‚   â”‚   â””â”€â”€ indexer.go       # Logic: Chunking Strategy
â”‚   â”œâ”€â”€ personas/
â”‚   â”‚   â””â”€â”€ manager.go       # Logic: åŠ è½½è§’è‰²é…ç½®
â”‚   â””â”€â”€ ingestion/
â”‚       â””â”€â”€ jina.go          # Client: Jina Reader API
â”œâ”€â”€ internal/                # ä¾èµ– PB çš„é€‚é…å±‚
â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â”œâ”€â”€ on_article.go    # Hook: Article Create -> Trigger RAG
â”‚   â”‚   â””â”€â”€ cron.go          # Hook: Weekly Report Job
â”‚   â””â”€â”€ api/
â”‚       â””â”€â”€ mcp.go           # Handler: MCP Server Endpoints
â”œâ”€â”€ go.mod
â””â”€â”€ go.sum
```

---

## 4. å‰ç«¯é€‚é…æ–¹æ¡ˆ (Astro 5.0)

å‰ç«¯å°†ä¿æŒè½»é‡çº§ï¼Œæ ¸å¿ƒé¡µé¢é¢„æ¸²æŸ“ï¼ŒåŠ¨æ€å†…å®¹å»¶è¿ŸåŠ è½½ã€‚

*   **Repository**: ç‹¬ç«‹ä»“åº“ `l-souljourney-web` (æˆ–åœ¨ monorepo ä¸­ `web/`)
*   **Adapter**: Node.js or Vercel/Netlify (SSR mode)
*   **Data Fetching**:
    *   **Build Time**: `getStaticPaths` è·å–æ‰€æœ‰æ–‡ç«  slugã€‚
    *   **Run Time**: `Astro.glob` æˆ– `pb.collection('articles').getOne` è·å–è¯¦æƒ…ã€‚
*   **Interactive Islands**:
    *   `<DebatePanel client:visible />`: è¿™æ˜¯ä¸€ä¸ª Vue/React ç»„ä»¶ã€‚å½“ç”¨æˆ·æ»šåŠ¨åˆ°åº•éƒ¨æ—¶ï¼Œè¯·æ±‚åç«¯ `/api/debates/{article_id}` åŠ è½½ AI è¯„è®ºï¼Œä¼˜åŒ–é¦–å±é€Ÿåº¦ã€‚

---

## 5. Vibe Coding æ‰§è¡Œè·¯çº¿å›¾ (Execution Roadmap)

æˆ‘ä»¬å°†é‡‡ç”¨ **"CLI First"** çš„ç­–ç•¥ï¼Œå…ˆè·‘é€šå‘½ä»¤è¡Œï¼Œå†æ¥ç•Œé¢ã€‚

### ğŸ“… Phase 1: éª¨æ¶ä¸ç¥ç» (Skeleton & Neural)
*   **ç›®æ ‡**: è·‘é€š `Go -> CNB -> Doubao -> Console` çš„é“¾è·¯ã€‚
*   **Tasks**:
    1.  [ ] åˆå§‹åŒ– Go é¡¹ç›®ä¸ PocketBaseã€‚
    2.  [ ] ç¼–å†™ `pkg/rag/cnb.go`: å®ç° `Push()` å’Œ `Search()`ã€‚
    3.  [ ] ç¼–å†™ `pkg/ai/doubao.go`: å®ç° `Chat()`ã€‚
    4.  [ ] **éªŒè¯ç‚¹**: ç¼–å†™ä¸€ä¸ª `cmd/test_rag/main.go`ï¼Œåœ¨ç»ˆç«¯è¾“å…¥é—®é¢˜ï¼Œèƒ½çœ‹åˆ° RAG æ£€ç´¢ç»“æœå’Œ Doubao çš„å›ç­”ã€‚

### ğŸ“… Phase 2: è®°å¿†ä¸è§¦å‘å™¨ (Memory & Triggers)
*   **ç›®æ ‡**: è¿™é‡Œäº§ç”Ÿâ€œä¸šåŠ¡é—­ç¯â€ã€‚
    1.  [ ] å®šä¹‰ PocketBase Schema (`migrations/`).
    2.  [ ] ç¼–å†™ Hook: å½“ API åˆ›å»ºæ–‡ç« æ—¶ï¼Œè‡ªåŠ¨è§¦å‘ Phase 1 çš„é€»è¾‘ã€‚
    3.  [ ] å­˜å…¥ `ai_comments` å­—æ®µã€‚
    4.  [ ] **éªŒè¯ç‚¹**: Postman å‘é€ä¸€ç¯‡ JSON æ–‡ç« ï¼Œç­‰å¾… 10s åï¼Œæ•°æ®åº“ä¸­å‡ºç° AI ç‚¹è¯„ã€‚

### ğŸ“… Phase 3: èº¯ä½“å‘ˆç° (The Body)
*   **ç›®æ ‡**: Astro å‰ç«¯å±•ç¤ºã€‚
    1.  [ ] å‡çº§ Astro é¡¹ç›®ï¼Œæ¥å…¥ PocketBase SDKã€‚
    2.  [ ] å¼€å‘æ–‡ç« è¯¦æƒ…é¡µã€‚
    3.  [ ] å¼€å‘ `<DebatePanel />` å²›å±¿ç»„ä»¶ã€‚

### ğŸ“… Phase 4: æ„Ÿå®˜å»¶ä¼¸ (Senses)
*   **ç›®æ ‡**: è‡ªåŠ¨åŒ–é‡‡é›†ã€‚
    1.  [ ] é›†æˆ Jina Readerã€‚
    2.  [ ] å®ç° RSS å®šæ—¶æŠ“å–ä»»åŠ¡ã€‚

---

## 6. ç«‹å³æ‰§è¡ŒæŒ‡ä»¤ (Immediate Actions)

è¯·ç¡®è®¤æ­¤æ–¹æ¡ˆæ— è¯¯ã€‚ç¡®è®¤åï¼Œæˆ‘ä»¬å°†ä» **Phase 1** å¼€å§‹ï¼š
1.  åˆ›å»º `l-engine` ç›®å½•ã€‚
2.  åˆå§‹åŒ– `go.mod`ã€‚
3.  å®‰è£… PocketBase ä¾èµ–ã€‚
