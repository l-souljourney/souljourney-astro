这份文档是为您量身定制的 **L-忠程 2.0：基于 Jina + Doubao + PocketBase 的智能内容中台架构方案**。

此方案完全基于 **Vibe Coding**（AI 辅助编程）理念设计，旨在通过最简化的技术栈实现最强大的自动化能力。请将此文档作为 **Context** 提供给 Antigravity IDE 中的 Gemini，以启动开发。

***

# 🚀 L-忠程 2.0 生态升级方案：Jina-Doubao-PB 架构

## 1. 项目愿景 (Vision)
打造一个**单人全栈 (Solo-Stack)** 的智能内容中台。
秉承“生死看淡，不服就淦”的精神，摒弃臃肿的分布式架构，回归代码的掌控感。利用 **Jina** 的阅读能力和 **Doubao** 的思考能力，让 **PocketBase** 成为博客的“第二大脑”，实现从信息获取、分析到发布的自动化闭环。

---

## 2. 核心技术架构 (Architecture)

### 2.1 逻辑模型：J.D.P. 三位一体
*   **👀 阅读 (Reading) - Jina Reader**:
    *   **角色**: 信息采集员。
    *   **职责**: 将任意 URL (导航站目标、新闻源) 转化为干净、LLM 友好的 Markdown。
    *   **实现**: 调用 `https://r.jina.ai/` API，无须维护本地爬虫。
*   **🧠 思考 (Thinking) - Doubao (Volcengine)**:
    *   **角色**: 内容分析师。
    *   **职责**: 基于 Markdown 进行摘要、分类、打标签、翻译、生成周报。
    *   **实现**: 火山引擎 Go SDK (Doubao-pro-32k 模型)。
*   **💾 记忆 (Memory) - PocketBase (Go Framework)**:
    *   **角色**: 中枢神经与存储。
    *   **职责**: 数据库 (SQLite)、后台管理 (Admin UI)、任务调度 (Cron)、Git 操作 (发布)。
    *   **实现**: 阿里云 FC (计算) + NAS (持久化存储)。

### 2.2 技术栈清单 (Tech Stack)
*   **后端框架**: **Go 1.23** + **PocketBase** (作为 Framework 使用)
*   **数据库**: **SQLite** (PocketBase 内置，WAL 模式)
*   **部署环境**: **阿里云函数计算 (FC)** + **NAS 文件存储**
*   **前端展示**: **Astro 5.16** (保持现有架构，构建时从 PocketBase 拉取数据)
*   **外部服务**:
    *   **Jina Reader API** (免费/低成本)
    *   **Volcengine API** (豆包大模型)
    *   **GitHub** (代码与内容托管)

---

## 3. 数据库设计 (Schema Design)

请指示 Gemini 在 PocketBase 中预创建以下集合（或通过 Go 代码迁移）：

1.  **`sites` (AI 导航收录)**
    *   `url` (url, unique): 目标网址
    *   `title` (text): 网站标题
    *   `summary` (editor): AI 生成的简介
    *   `category` (select): 分类 (如: 图像生成, 写作助手, 编程开发)
    *   `tags` (json): 标签数组
    *   `markdown_cache` (text): Jina 抓取的原始 Markdown (用于缓存)
    *   `status` (select): pending (待审) / published (已发布)

2.  **`weekly_sources` (周报素材池)**
    *   `url` (url): 新闻链接
    *   `source_type` (select): rss / manual (手动录入)
    *   `raw_markdown` (text): Jina 抓取的内容
    *   `ai_summary` (text): 豆包生成的单篇摘要
    *   `batch_id` (relation): 关联到具体的周报期数

3.  **`app_config` (系统配置)**
    *   `key`: 如 `rss_list`, `prompts`
    *   `value`: JSON 格式的配置

---

## 4. Vibe Coding 研发实施路径 (Step-by-Step)

请按以下 Phase 顺序复制指令到 Antigravity。

### Phase 1: 基础设施搭建 (The Foundation)
**目标**: 跑通 PocketBase + Jina 的基础链路。

> **Prompt to Gemini:**
> "创建一个名为 `l-engine` 的 Go 项目。
> 1.  初始化 Go mod，引入 `github.com/pocketbase/pocketbase`。
> 2.  **核心逻辑**: 编写 `pkg/reader/jina.go`。实现函数 `FetchURL(url string) (string, error)`。逻辑是发送 HTTP GET 请求到 `https://r.jina.ai/<url>`，返回 Body 内容（即 Markdown）。
> 3.  **主程序**: 在 `main.go` 中初始化 PocketBase。注册一个 API 路由 `GET /api/test-jina?url=...` 来测试上述函数。
> 4.  **Docker**: 编写 `Dockerfile`。使用 `alpine:latest` 作为基础镜像（因为不需要 Chrome 了，体积可以很小），构建 Go 二进制文件。暴露 8090 端口。"

### Phase 2: 智能导航录入 (Smart Navigation)
**目标**: 实现“输入 URL -> 自动填好所有信息”。

> **Prompt to Gemini:**
> "扩展 PocketBase 的功能，实现 AI 导航站的自动化录入。
> 1.  集成火山引擎 SDK (`github.com/volcengine/volc-sdk-golang`)。
> 2.  **Hook 开发**: 监听 `sites` 集合的 `OnRecordBeforeCreateRequest`。
> 3.  **业务流程**:
>     *   当管理员在后台填入 URL 提交时：
>     *   调用 `reader.FetchURL` 获取 Markdown。
>     *   将 Markdown 发送给豆包 AI。System Prompt: '你是一个软件分析师，请根据网页内容总结：中文标题、100字简介、3个分类标签。返回 JSON。'
>     *   解析 AI 返回的 JSON，自动填充到 `title`, `summary`, `tags`, `markdown_cache` 字段中。
>     *   如果 Jina 抓取失败，允许记录创建，但标记错误信息。"

### Phase 3: 周报 Agent 与 Git 发布 (Weekly Agent)
**目标**: 实现周报的自动聚合与发布。

> **Prompt to Gemini:**
> "开发周报自动化模块。
> 1.  **RSS 抓取**: 引入 `github.com/mmcdole/gofeed`。编写定时任务（Cron），每 4 小时抓取配置的 RSS 源，将新链接存入 `weekly_sources` 表。
> 2.  **周报生成**: 注册 API `POST /api/agent/generate-weekly`。
>     *   读取本周未处理的 `weekly_sources`。
>     *   调用 Jina 获取全文，调用 AI 生成单篇摘要。
>     *   再次调用 AI，将所有摘要汇总成一篇结构化的 Markdown 周报（包含 '核心观察', '深度精选' 等板块）。
> 3.  **Git 发布**: 引入 `github.com/go-git/go-git/v5`。
>     *   实现 `Clone` (拉取博客仓库), `WriteFile` (写入 `src/content/blog/weekly/`), `Commit`, `Push` 流程。
>     *   注意：SSH Key 必须从环境变量读取，不能硬编码。"

### Phase 4: 部署与交付 (Deployment)
**目标**: 上线阿里云 FC。

> **Prompt to Gemini:**
> "编写阿里云 Serverless Devs 的配置文件 `s.yaml`。
> 1.  **服务配置**: 名称 `l-engine`，内存 **512MB** (去掉了 Chrome，内存需求大幅降低)，超时 60秒。
> 2.  **存储配置**: 配置 VPC 和 NAS 挂载。将 NAS 的 `/mnt/l-blog` 挂载到容器的 `/pb_data`。
> 3.  **环境变量**: 定义 `VOLC_ACCESS_KEY`, `VOLC_SECRET_KEY`, `GIT_SSH_KEY` 等占位符。"

---

## 5. 关键配置与避坑指南 (Guidelines)

### 5.1 Jina Reader 的使用策略
*   **User-Agent**: 在 Go 的 `http.Client` 中，设置 User-Agent 为常见浏览器 (e.g., `Mozilla/5.0...`)，虽然 Jina 对 API 友好，但保持良好的请求头习惯能避免部分误判。
*   **缓存机制**: PocketBase 中的 `markdown_cache` 字段非常重要。AI 分析前**必须**先检查数据库是否有缓存，以节省 Jina 的额度和请求时间。

### 5.2 部署成本优化
*   由于移除了 Chromedp (Headless Browser)，你的 Docker 镜像大小将从 ~600MB 骤降至 **~20MB** (Alpine + Go Binary)。
*   **FC 内存**: 512MB 绰绰有余。
*   **FC 实例**: 设置 `min provisioned instances` (预留实例) 为 0。虽然会有冷启动（约 1-2秒），但对于后台管理系统来说完全可接受，且能把成本降到最低（按量付费）。

### 5.3 数据安全
*   **Admin UI**: PocketBase 的 Admin UI (`/_/`) 是公开的。务必设置强密码。
*   **API Rules**:
    *   `sites`: `List/View` 设为 Public (供 Astro 构建时拉取)。
    *   `sites`: `Create/Update/Delete` 设为 Admin Only (防止恶意篡改)。
    *   `weekly_sources`: Admin Only。

---

## 6. 总结 (Conclusion)

这套 **J.D.P. (Jina-Doubao-PocketBase)** 架构完美契合了你 **L-忠程** 的核心诉求：
1.  **极简**: 没有 Node.js，没有 Python，没有 Chrome，只有一个 Go 二进制文件。
2.  **强大**: 依靠 Jina 和 Doubao，你拥有了顶级的阅读和分析能力。
3.  **低成本**: 几乎零运维，利用 Serverless 和 API 免费额度。

现在，你可以将这套方案交给 Antigravity，开始你的 Vibe Coding 之旅了。