# v2.0.0 éƒ¨ç½²æµ‹è¯•è®°å½•

**æ—¥æœŸ**ï¼š2026-02-15  
**ç›®æ ‡**ï¼šGitHub Actions éƒ¨ç½²åˆ°è…¾è®¯äº‘ COS

---

## æµ‹è¯•å†ç¨‹

### ç¬¬ 1 æ¬¡å°è¯•ï¼šynext1213/cos-cli-action

**Workflow æ–‡ä»¶**ï¼šåˆå§‹ç‰ˆæœ¬ä½¿ç”¨ `ynext1213/cos-cli-action@v1`

**ç»“æœ**ï¼šâŒ å¤±è´¥  
**æŠ¥é”™**ï¼š
```
Unable to resolve action ynext1213/cos-cli-action, repository not found
```

**åŸå› **ï¼šè¯¥ action ä¸å­˜åœ¨äº GitHub Marketplace

---

### ç¬¬ 2 æ¬¡å°è¯•ï¼šTencentCloud/cos-actionï¼ˆå‚æ•°é”™è¯¯ï¼‰

**ä¿®å¤**ï¼šæ”¹ç”¨è…¾è®¯äº‘å®˜æ–¹çš„ `TencentCloud/cos-action@v1`

**ç»“æœ**ï¼šâŒ å¤±è´¥  
**æŠ¥é”™**ï¼š
```
fail to upload files to cos: Error: ENOENT: no such file or directory, lstat ''
Unexpected input(s) 'bucket', 'region', 'upload_dir', 'remote_dir', 
valid inputs are ['secret_id', 'secret_key', 'cos_bucket', 'cos_region', 'local_path', 'remote_path', 'clean']
```

**åŸå› **ï¼šä½¿ç”¨äº†é”™è¯¯çš„å‚æ•°å

**ä¿®å¤**ï¼šä¿®æ­£å‚æ•°ä¸º `cos_bucket`, `cos_region`, `local_path`, `remote_path`

---

### ç¬¬ 3 æ¬¡å°è¯•ï¼šTencentCloud/cos-actionï¼ˆå‚æ•°ä¿®æ­£ï¼‰

**ä¿®å¤**ï¼šæ›´æ–°å‚æ•°åç§°

**ç»“æœ**ï¼šâŒ å¤±è´¥ï¼ˆJob å¡ä½ï¼‰  
**ç°è±¡**ï¼šdeploy-cos job ä¸€ç›´å¤„äº in_progress çŠ¶æ€ï¼Œè¶…è¿‡ 8 åˆ†é’Ÿæœªå®Œæˆ

**å¯èƒ½åŸå› **ï¼š
1. action å†…éƒ¨æ‰§è¡Œè¶…æ—¶
2. ç½‘ç»œé—®é¢˜å¯¼è‡´ COS API è°ƒç”¨ç¼“æ…¢
3. action æœ¬èº«å­˜åœ¨ bug

---

### ç¬¬ 4 æ¬¡å°è¯•ï¼šcoscliï¼ˆæœ€ç»ˆæ–¹æ¡ˆï¼‰

**ä¿®å¤**ï¼šæ”¹ç”¨ `git9527/setup-coscli@v1` + `coscli sync` å‘½ä»¤

**æ–¹æ¡ˆæ¥æº**ï¼šå‚è€ƒ `.cnb.yml` ä¸­çš„æˆåŠŸå®è·µï¼ˆä½¿ç”¨ `tencentcom/coscli:latest` é•œåƒï¼‰

**Workflow é…ç½®**ï¼š
```yaml
- name: Setup coscli
  uses: git9527/setup-coscli@v1
  with:
    region: ${{ secrets.COS_REGION }}
    secret-id: ${{ secrets.TENCENT_CLOUD_SECRET_ID }}
    secret-key: ${{ secrets.TENCENT_CLOUD_SECRET_KEY }}
    bucket: ${{ secrets.COS_BUCKET }}
    coscli-version: latest

- name: Sync to COS
  run: coscli sync dist/ cos://${{ secrets.COS_BUCKET }}/ --delete --force --recursive
```

**ç»“æœ**ï¼šç­‰å¾…éªŒè¯ä¸­...

---

## é™„å¸¦é—®é¢˜

### åˆå§‹è¯­æ³•é”™è¯¯

**é—®é¢˜**ï¼šåœ¨ workflow ä¸­ä½¿ç”¨äº†é”™è¯¯çš„æ¡ä»¶åˆ¤æ–­
```yaml
if: secrets.TEO_ZONE_ID != ''
```

**ç»“æœ**ï¼šâŒ å¤±è´¥  
**æŠ¥é”™**ï¼š`This run likely failed because of a workflow file issue`

**ä¿®å¤**ï¼šç§»é™¤äº† CDN åˆ·æ–°æ­¥éª¤ï¼ˆå¾… TEO_ZONE_ID é…ç½®å¥½åå¯é‡æ–°æ·»åŠ ï¼‰

---

## æœ€ç»ˆ Workflow

```yaml
name: Deploy to COS + CDN

on:
  push:
    branches: [main]

  pull_request:
    branches: [main]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Setup pnpm
        uses: pnpm/action-setup@v4
        with:
          version: 9
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20
          cache: 'pnpm'
      - name: Install dependencies
        run: pnpm install --frozen-lockfile
      - name: Build
        run: pnpm build
      - name: Upload build artifacts
        uses: actions/upload-artifact@v4
        with:
          name: dist
          path: dist/
          retention-days: 1

  deploy-cos:
    needs: build
    runs-on: ubuntu-latest
    if: github.event_name == 'push' && github.ref == 'refs/heads/main'
    steps:
      - name: Download build artifacts
        uses: actions/download-artifact@v4
        with:
          name: dist
          path: dist/
      - name: Setup coscli
        uses: git9527/setup-coscli@v1
        with:
          region: ${{ secrets.COS_REGION }}
          secret-id: ${{ secrets.TENCENT_CLOUD_SECRET_ID }}
          secret-key: ${{ secrets.TENCENT_CLOUD_SECRET_KEY }}
          bucket: ${{ secrets.COS_BUCKET }}
          coscli-version: latest
      - name: Sync to COS
        run: coscli sync dist/ cos://${{ secrets.COS_BUCKET }}/ --delete --force --recursive
      - name: Show deployment info
        run: |
          echo "âœ… COS deployment completed"
          if [ -n "${{ secrets.CDN_DOMAIN }}" ]; then
            echo "ğŸŒ Website: https://${{ secrets.CDN_DOMAIN }}"
          fi
```

---

## å¾…å®Œæˆ

1. **CDN åˆ·æ–°**ï¼šéœ€é…ç½® `TEO_ZONE_ID` åæ·»åŠ  CDN åˆ·æ–°æ­¥éª¤
2. **éªŒè¯**ï¼šç¡®è®¤ COS æ–‡ä»¶åŒæ­¥æˆåŠŸ + ç½‘ç«™å¯è®¿é—®
