# Souljourney Blog 2.0 架构重构方案

**版本：** 2.0  
**日期：** 2026-02-15  
**目标：** 替代 CNB 构建，实现 GitHub Actions 自动部署

---

## 一、背景

当前项目使用 CNB (cnb.cool) 进行构建部署，存在以下问题：
1. CNB → GitHub 同步依赖 token（已泄露，已修复）
2. GitHub Actions 历史 workflow 已丢失
3. 部署链路冗余：CNB → GitHub → COS → EdgeOne

**目标架构：** GitHub 为唯一代码源，通过 GitHub Actions 直接部署到 Cloudflare Pages 和腾讯云 COS

---

## 二、核心目标

| # | 目标 | 状态 |
|:--|:--|:--|
| 1 | 修复 GitHub Actions 自动构建部署 | 待执行 |
| 2 | 实现 Cloudflare Pages 自动部署 | 待执行 |
| 3 | 实现腾讯云 COS + CDN 自动部署 | 待执行 |
| 4 | 清理历史冗余配置 | 待执行 |

---

## 三、执行步骤

### 阶段 1：环境准备

- [ ] 1.1 确认部署目标（Cloudflare + 腾讯云 COS 双部署）
- [ ] 1.2 配置 GitHub Secrets
- [ ] 1.3 确认腾讯云 COS 信息

### 阶段 2：GitHub Actions 部署 Cloudflare Pages

- [ ] 2.1 创建 `.github/workflows/deploy-cloudflare.yml`
- [ ] 2.2 配置 pnpm + Node.js 构建环境
- [ ] 2.3 添加 Cloudflare Pages 部署步骤
- [ ] 2.4 提交推送并验证 Actions 运行

### 阶段 3：GitHub Actions 部署腾讯云 COS

- [ ] 3.1 更新 workflow 添加 COS 部署步骤
- [ ] 3.2 配置 CDN 缓存刷新
- [ ] 3.3 验证 COS 文件同步

### 阶段 4：清理历史配置

- [ ] 4.1 删除/归档 `.cnb.yml`
- [ ] 4.2 处理 `wrangler.jsonc`
- [ ] 4.3 清理其他旧部署配置

### 阶段 5：验证与收尾

- [ ] 5.1 本地构建验证
- [ ] 5.2 GitHub Actions 完整流程验证
- [ ] 5.3 部署后功能验证
- [ ] 5.4 更新 AGENTS.md

---

## 四、需要配置的 Secrets

| Secret | 用途 | 状态 |
|:--|:--|:--|
| `CLOUDFLARE_API_TOKEN` | Cloudflare Pages 部署 | ⬜ |
| `CLOUDFLARE_ACCOUNT_ID` | Cloudflare 账户 ID | ⬜ |
| `TENCENT_CLOUD_SECRET_ID` | 腾讯云访问密钥 | ⬜ |
| `TENCENT_CLOUD_SECRET_KEY` | 腾讯云访问密钥 | ⬜ |
| `COS_BUCKET` | COS 存储桶名称 | ⬜ |
| `COS_REGION` | COS 区域 | ⬜ |
| `CDN_DOMAIN` | CDN 域名 | ⬜ |

---

## 五、部署流程设计

```
GitHub Push
    │
    ▼
┌─────────────────────────┐
│  GitHub Actions        │
│  ┌───────────────────┐  │
│  │ 1. Checkout      │  │
│  │ 2. Setup pnpm   │  │
│  │ 3. pnpm install │  │
│  │ 4. pnpm build   │  │
│  │ 5. Deploy CF   │  │
│  │ 6. Deploy COS   │  │
│  └───────────────────┘  │
└─────────────────────────┘
    │
    ├──▶ Cloudflare Pages (海外 CDN)
    │
    └──▶ 腾讯云 COS + CDN (国内 CDN)
```

---

## 六、验收标准

- [ ] 每次 `git push` 自动触发 Actions 构建
- [ ] Cloudflare Pages 部署成功，可访问
- [ ] 腾讯云 COS 文件同步成功
- [ ] CDN 缓存刷新成功
- [ ] 旧配置已清理
