# SoulJourney 2.0 升级方案：AI 驱动的混合架构 (The "Hybrid Vibe" Stack)

## 1. 核心设计理念：动静分离，单体维护

针对您"单人维护、融合架构"的需求，2.0 版本的核心在于 **Hybrid Rendering (混合渲染)**。

*   **博客 (Blog)**：保持 **SSG (静态生成)**。极致 SEO，零成本托管。
*   **导航 (Nav)**：采用 **SSR (服务端渲染) + 数据库**。动态交互，即时更新，无需构建。
*   **管理 (Admin)**：**内置于 Astro 内部**的轻量级后台。无需独立部署。

---

## 2. 技术栈选型 (The Solo Developer Stack)

这套技术栈专为"单人全栈 + AI 辅助"设计：

*   **框架**: [Astro 5.0](https://astro.build/) (Output: Hybrid)
*   **前端交互**: Vue 3 + Tailwind CSS (复用现有组件)
*   **数据库**: [Turso (LibSQL)](https://turso.tech/)
    *   *理由*：Serverless SQLite，免费额度大 (90亿读/月)，HTTP 协议连接，完美适配边缘环境，比 Supabase 更轻量。
*   **ORM**: [Drizzle ORM](https://orm.drizzle.team/)
    *   *理由*：TypeScript 优先，零运行时开销，智能提示体验极佳。
*   **AI 引擎**: OpenAI / Claude (通过 Astro API Routes 调用)
*   **部署**: 现有的 CNB/Netlify/Vercel (保持不变，支持 Node.js 适配器即可)

---

## 3. 架构设计详解

### 3.1 目录结构 (Monorepo-like)

```text
src/
├── content/              # [静态] 博客文章 (Markdown)
│   └── blog/
├── db/                   # [动态] 数据库 Schema
│   ├── schema.ts         # Drizzle 定义 (Sites, Categories, Tags)
│   └── client.ts         # Turso 连接
├── pages/
│   ├── index.astro       # 首页 (SSG)
│   ├── blog/[...slug].astro # 文章页 (SSG)
│   ├── nav/              
│   │   ├── index.astro   # [SSR] 导航首页 (从 DB 读数据)
│   │   └── [id].astro    # [SSR] 工具详情页
│   ├── admin/            # [SSR] 隐形管理后台
│   │   ├── index.astro   # 仪表盘
│   │   └── login.astro   # 极简登录
│   └── api/              # [后端] API Routes
│       ├── ai-analyze.ts # AI 分析服务
│       └── sites.ts      # 增删改查接口
└── components/
    └── admin/            # 管理后台专用组件 (发布器、审核流)
```

### 3.2 关键流程设计

#### A. 网址收录流程 (AI 介入点)
**痛点解决**：以往收录一个网址需要：截图 -> 查简介 -> 写 Markdown -> Git Push -> 等待构建 (3-5分钟)。
**2.0 方案**：**后台即刻发布 (Instant Publish)**。

1.  **输入**：在 `/admin` 仪表盘输入 URL。
2.  **AI 处理 (Vibe Mode)**：
    *   后端 API 调用 Puppeteer/Cheerio 抓取 Meta 信息。
    *   LLM 分析：生成 50 字短评、提取 3 个核心 Tag、自动归类。
3.  **人工确认**：后台弹出预览卡片，您只需点击"确认"或微调。
4.  **入库**：数据写入 Turso 数据库。
5.  **上线**：`/nav` 页面刷新即见，**无需触发整个网站构建**。

#### B. 博客发布流程
保持现有 `Obsidian -> Git -> CNB Build` 流程不变。
*   **理由**：文章更新频率低，静态化保证最佳阅读体验和 SEO。

#### C. 混合构建策略 (Build Strategy)
Astro 配置文件中开启混合模式：

```javascript
// astro.config.mjs
import { defineConfig } from 'astro/config';
import node from '@astrojs/node'; // 或 vercel, netlify

export default defineConfig({
  output: 'hybrid', // 关键：开启混合模式
  adapter: node({
    mode: 'standalone'
  }),
  // ...
});
```
*   `export const prerender = true`：用于博客与首页。
*   `export const prerender = false`：用于 `/nav/*` 和 `/admin/*`。

---

## 4. 核心功能模块设计的思考

### 4.1 管理后台 (Is there an Admin?)
**有，且必须有。** 但不需要复杂的权限系统，因为只有你一个用户。

*   **实现**：一个受保护的路由组 `/admin/*`。
*   **鉴权**：设置一个环境变量 `ADMIN_PASSWORD`。在 Astro 中写一个简单的 Middleware，检查 Cookie 中是否有 Token，没有则重定向到登录页。
*   **界面**：直接使用 Shadcn Vue 组件搭建，"左侧表单，右侧 AI 预览"。

### 4.2 动态资源的融入
图片（Logo / 截图）怎么存？
*   **方案**：直接存 **对象存储 (R2 / OSS / COS)**。
*   **AI 自动化**：在抓取 URL 时，后端自动下载 `og:image`，上传到您的图床，通过 Image Service 压缩，将 CDN 链接存入数据库。不要把图片存 Git，会这也是导致仓库臃肿构建慢的原因。

### 4.3 商业化预埋
*   **字段设计**：在 Database Schema 中预留 `affiliate_link` (返利链接) 和 `click_count` (点击统计)。
*   **统计**：每次点击外链，先请求一个简单的 `/api/track?id=xxx` 接口，然后跳转。方便您后期分析哪些工具最受欢迎，指导内容创作。

---

## 5. 2.0 版本演进路线图 (Roadmap)

### 第一阶段：基础设施 (Infrastructure)
1.  **数据库接入**：配置 Turso，初始化 Drizzle Schema。
2.  **管理后台 MVP**：实现 `/admin` 登录，以及简单的 "URL -> DB" 增删改查。
3.  **导航页重构**：从 Turso 读取数据渲染 `/nav` 页面。

### 第二阶段：AI 增强 (AI Empowerment)
1.  **AI Scraper**：实现 `/api/analyze`，自动抓取 + GPT 总结。
2.  **图片自动化**：对接图床，实现 Logo 自动抓取上传。

### 第三阶段：融合与优化 (Optimization)
1.  **首页融合**：在博客首页加入 "本周推荐工具" 板块 (SSR 获取或 SSG 构建时获取)。
2.  **关联推荐**：文章底部通过 Tags 自动关联相关的导航工具。

---

## 6. 总结

这个方案最适合您的点在于：**"该静的静，该动的动"**。
文章需要沉淀，用 Markdown 静态托管；工具需要迭代，用数据库+AI动态管理。
您不再是简单的"写博客"，而是在运营一个 **"内容资产管理系统"**。
